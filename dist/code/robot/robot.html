<!DOCTYPE html><html lang="en"><head><title>robot/robot</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="robot/robot"><meta name="groc-project-path" content="dist/exercise/assets/robot/robot.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">dist/exercise/assets/robot/robot.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="robotjs">robot.js</h1>
<p>This file contains code all about the robot.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-pi">'use strict'</span>;

<span class="hljs-keyword">var</span> lionElement = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'lion'</span>);
<span class="hljs-keyword">var</span> sceneElement = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'scene'</span>);
<span class="hljs-keyword">var</span> lion = <span class="hljs-keyword">new</span> Robot(lionElement);


<span class="hljs-keyword">var</span> scene = <span class="hljs-keyword">new</span> Scene(sceneElement);
<span class="hljs-keyword">var</span> animator = <span class="hljs-keyword">new</span> Animator();

animator.startLoop();

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeNewRobot</span>(<span class="hljs-params">id, imageURL</span>)</span>{
  <span class="hljs-keyword">var</span> robotEl = makeNewRobotBody(id, imageURL);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Robot(robotEl);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeNewRobotBody</span>(<span class="hljs-params">id, imageURL</span>)</span>{
  <span class="hljs-keyword">var</span> robotBody = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
  <span class="hljs-keyword">var</span> robotImage = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>);
  robotBody.classList.add(<span class="hljs-string">'robot'</span>);
  robotImage.src = imageURL;
  robotBody.appendChild(robotImage);

  sceneElement.appendChild(robotBody);

  <span class="hljs-keyword">return</span> robotBody;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Robot</span>(<span class="hljs-params">robotElement</span>) </span>{</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>robotMethods</code> will hold onto what the robot can do.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">var</span> robotMethods = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>);
  robotMethods.getPosition = getPosition;
  robotMethods.getSize = getSize;
  robotMethods.moveTo = moveTo;
  robotMethods.move = move;
  robotMethods.moveRandom = moveRandom;
  robotMethods.change = change;
  robotMethods.reset = reset;
  robotMethods.name = name;
  robotMethods.flip = flip;
  robotMethods.getElement = getElement;
  robotMethods.getImage = getImage;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>We are going to use <code>robot</code> to hold onto some private information about our robot.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">var</span> robot = {};
  <span class="hljs-keyword">var</span> scene = {};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>setBody</code> gives the robot a body that is the HTML element passed in as <code>robotElement</code></p></div></div><div class="code"><div class="wrapper">  setBody(robotElement);

  setScene(robotElement.parentElement);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Give <code>robotMethods</code> out to the coder use elsewhere, as in the <code>console</code>.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">return</span> robotMethods;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h1 id="functions">Functions</h1></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><h2 id="setbody">setBody</h2>
<p>Gives the robot a body.</p>
<p>Parameters:</p>
<ul>
<li><strong>robotElement must be a DOMElement.</strong><br/>(The HTML Element that the robot&#39;s capabilities should be attached to.)</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setBody</span>(<span class="hljs-params">robotElement</span>)</span>{

    <span class="hljs-keyword">if</span>(doParametersFail(<span class="hljs-built_in">arguments</span>, <span class="hljs-string">'setBody'</span>)){
      <span class="hljs-keyword">return</span>;
    }

    robot.element = robotElement;
    robot.img = robot.element.getElementsByTagName(<span class="hljs-string">'img'</span>)[<span class="hljs-number">0</span>]
    robot.img.onload = setSizeAndPosition;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Force an image reload to make <code>setSizeAndPosition</code> run.</p></div></div><div class="code"><div class="wrapper">    robot.img.src = robot.img.src;
    robot.name = <span class="hljs-string">''</span>;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setScene</span>(<span class="hljs-params">sceneElement</span>)</span>{
    scene.element = sceneElement;
    setSceneSize();
    <span class="hljs-built_in">window</span>.onresize = _.throttle(setSceneSize, <span class="hljs-number">100</span>);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setSizeAndPosition</span>(<span class="hljs-params"></span>)</span>{
    robot.size = getSize();
    robot.position = <span class="hljs-keyword">new</span> Position(robotMethods);

    <span class="hljs-keyword">if</span>(!robot.defaults){    
      setDefaults();
    }
  }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="setdefaults">setDefaults</h2>
<p>Remembers the initial information about the robot.
We can use <code>robot.defaults</code> later to be able to reset the robot to it&#39;s original state.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setDefaults</span>(<span class="hljs-params"></span>)</span>{
    robot.defaults = {}
    robot.defaults.src = robot.img.getAttribute(<span class="hljs-string">'src'</span>);
    robot.defaults.position = getPosition();
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setSceneSize</span>(<span class="hljs-params"></span>)</span>{
    scene.size = scene.element.getBoundingClientRect();
    scene.element.dataset.width = <span class="hljs-built_in">Math</span>.round(scene.size.width);
    scene.element.dataset.height = <span class="hljs-built_in">Math</span>.round(scene.size.height);
  }</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><h2 id="getposition">getPosition</h2>
<p>Tells us where the robot is.</p>
<p><strong>Returns an Object</strong><br/>(with an x and y for where the robot is.)</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPosition</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> boundingRectangle = robot.element.getBoundingClientRect();
    <span class="hljs-keyword">return</span> {
      x: boundingRectangle.left + boundingRectangle.width/<span class="hljs-number">2</span>,
      y: boundingRectangle.top + boundingRectangle.height/<span class="hljs-number">2</span>
    };
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSize</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> boundingRectangle = robot.element.getBoundingClientRect();
    <span class="hljs-keyword">var</span> size = {
      width: boundingRectangle.width,
      height: boundingRectangle.height
    };

    <span class="hljs-keyword">return</span> size;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">moveTo</span>(<span class="hljs-params">x, y</span>)</span>{

    <span class="hljs-keyword">if</span>(doParametersFail(<span class="hljs-built_in">arguments</span>, <span class="hljs-string">'moveTo'</span>)){
      <span class="hljs-keyword">return</span>;
    }

    robot.position.x = x;
    robot.position.y = y;
    <span class="hljs-keyword">return</span> robot.name + <span class="hljs-string">' moving to '</span> + x + <span class="hljs-string">', '</span> + y;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">move</span>(<span class="hljs-params">direction, distance</span>)</span>{

    <span class="hljs-keyword">var</span> movers = {
      left: moveLeft,
      right: moveRight,
      down: moveDown,
      up: moveUp
    };

    <span class="hljs-keyword">if</span>(doParametersFail(<span class="hljs-built_in">arguments</span>, <span class="hljs-string">'move'</span>)){
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">return</span> movers[direction](distance);

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">moveLeft</span>(<span class="hljs-params">distance</span>) </span>{
      <span class="hljs-keyword">var</span> currentPosition = getPosition();
      <span class="hljs-keyword">var</span> newX = currentPosition.x + distance;

      <span class="hljs-keyword">return</span> moveTo(newX, currentPosition.y);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">moveDown</span>(<span class="hljs-params">distance</span>) </span>{
      <span class="hljs-keyword">var</span> currentPosition = getPosition();
      <span class="hljs-keyword">var</span> newY = currentPosition.y + distance;

      <span class="hljs-keyword">return</span> moveTo(currentPosition.x, newY);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">moveRight</span>(<span class="hljs-params">distance</span>) </span>{
      <span class="hljs-keyword">return</span> moveLeft( - <span class="hljs-number">1</span> * distance);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">moveUp</span>(<span class="hljs-params">distance</span>) </span>{
      <span class="hljs-keyword">return</span> moveDown( - <span class="hljs-number">1</span> * distance);
    }
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">moveRandom</span>(<span class="hljs-params"></span>)</span>{</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Use the robot size to calculate where the center of the robot is
relative to the edge.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">var</span> robotSize = robot.size;
    <span class="hljs-keyword">var</span> xRobotCenter = robotSize.width/<span class="hljs-number">2</span>;
    <span class="hljs-keyword">var</span> yRobotCenter = robotSize.height/<span class="hljs-number">2</span>;

    <span class="hljs-keyword">var</span> maxRandomX = scene.size.width - robotSize.width;
    <span class="hljs-keyword">var</span> maxRandomY = scene.size.height - robotSize.height;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>Math.random()</code> returns a random number in between 0 and 1.
Multiplying it by the scene dimension scales the random number.
In this case, the random number will be between 0 and scene width
and height minus the robot width and height -- max random x and
max random y.</p>
<p>Adding the robot center helps offsets the position so that
it&#39;s the position for the center of the robot.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">var</span> randomX = <span class="hljs-built_in">Math</span>.random() * maxRandomX + xRobotCenter;
    <span class="hljs-keyword">var</span> randomY = <span class="hljs-built_in">Math</span>.random() * maxRandomY + yRobotCenter;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Use the previously defined <code>moveTo</code> to do the moving.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">return</span> moveTo(randomX, randomY);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">change</span>(<span class="hljs-params">imageURL</span>) </span>{
    <span class="hljs-keyword">if</span>(doParametersFail(<span class="hljs-built_in">arguments</span>, <span class="hljs-string">'change'</span>)){
      <span class="hljs-keyword">return</span>;
    }

    robot.img.src = imageURL;

    <span class="hljs-keyword">return</span> <span class="hljs-string">'Robot image set to '</span> + imageURL;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reset</span>(<span class="hljs-params"></span>) </span>{
    robot.position.angle = robot.defaults.position.angle;
    robot.position.scale = robot.defaults.position.scale;
    robot.position.x = robot.defaults.position.x;
    robot.position.y = robot.defaults.position.y;

    change(robot.defaults.src);

    <span class="hljs-keyword">return</span> <span class="hljs-string">'Robot reset to original position and image'</span>;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">name</span>(<span class="hljs-params">robotName</span>) </span>{
    <span class="hljs-keyword">if</span>(doParametersFail(<span class="hljs-built_in">arguments</span>, <span class="hljs-string">'name'</span>)){
      <span class="hljs-keyword">return</span>;
    }

    robot.name = robotName;
    robot.element.dataset.name = robotName;

    <span class="hljs-keyword">return</span> <span class="hljs-string">'Robot got named '</span> + robotName;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">flip</span>(<span class="hljs-params"></span>)</span>{
    robot.element.classList.toggle(<span class="hljs-string">'flip'</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-string">'Robot flipped!'</span>;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getElement</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">return</span> robot.element;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getImage</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">return</span> robot.img;
  }

}</div></div></div></div></body></html>